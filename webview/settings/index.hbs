<style>
  .uk-radio {
    margin-left: 5px;
  }

  .uk-form-label {
    font-size: 1.12em;
    margin-top: 10px;
    margin-bottom: 10px;
    display: inline-block;
  }
</style>
<div id="outer">
  <div id="inner">
    <div id="header">
      {{{header i18n/settings this}}}
    </div>

    <div id="body">
      <div class="uk-container uk-container-medium">
          <h3 class="uk-text-bold" href="#">{{i18n/mods}}</h3>
          <h4>{{nl2br i18n/modsNotice}}</h4>

          <label class="uk-form-label"
            uk-tooltip="title: {{nl2br i18n/randomTooltip}}; pos: bottom-left">Random:</label><br>
          <label>
            <input class="uk-radio settings-radio" type="radio" name="random" value="0" {{setChecked 0 mods/random}}>
            Disable
          </label>
          <label>
            <input class="uk-radio settings-radio" type="radio" name="random" value="1" {{setChecked 1 mods/random}}>
            Enable
          </label>
          <br>

          <label class="uk-form-label"
            uk-tooltip="title: {{nl2br i18n/vanishTooltip}}; pos: bottom-left">Vanish:</label><br>
          <label><input class="uk-radio settings-radio" type="radio" name="vanish" value="0"
              {{setChecked 0 mods/vanish}}>
            Disable</label>
          <label><input class="uk-radio settings-radio" type="radio" name="vanish" value="1"
              {{setChecked 1 mods/vanish}}>
            Hidden</label>
          <label><input class="uk-radio settings-radio" type="radio" name="vanish" value="2"
              {{setChecked 2 mods/vanish}}>
            Sudden</label>
          <br>

          <label class="uk-form-label"
            uk-tooltip="title: {{nl2br i18n/mirrorTooltip}}; pos: bottom-left">Mirror:</label><br>
          <label><input class="uk-radio settings-radio" type="radio" name="mirror" value="0"
              {{setChecked 0 mods/mirror}}>
            Disable</label>
          <label><input class="uk-radio settings-radio" type="radio" name="mirror" value="1"
              {{setChecked 1 mods/mirror}}>
            Enable</label>
          <br>

          <label class="uk-form-label" uk-tooltip="title: {{nl2br i18n/hpTooltip}}; pos: bottom-left">HP:</label><br>
          <label><input class="uk-radio settings-radio" type="radio" name="hp" value="0" {{setChecked 0 mods/hp}}>
            Default</label>
          <label><input class="uk-radio settings-radio" type="radio" name="hp" value="1" {{setChecked 1 mods/hp}}> No
            Fail</label>
          <label><input class="uk-radio settings-radio" type="radio" name="hp" value="2" {{setChecked 2 mods/hp}}>
            Sudden
            Death</label>
          <br>

          <label class="uk-form-label"
            uk-tooltip="title: {{nl2br i18n/applyForEventTooltip}}; pos: bottom-left">{{i18n/applyForEvent}}</label>
          <br>
          <label><input class="uk-radio settings-radio" type="radio" name="event" value="0" {{setChecked 0 mods/event}}>
            {{i18n/no}}</label>
          <label><input class="uk-radio settings-radio" type="radio" name="event" value="1" {{setChecked 1 mods/event}}>
            {{i18n/yes}}</label>
          <br>

          <label class="uk-form-label">MedFes song pool type:</label><br>
          <label><input class="uk-radio settings-radio" type="radio" name="mf-song-pool" value="0" disabled>
            Default</label>
          <label><input class="uk-radio settings-radio" type="radio" name="mf-song-pool" value="1" disabled>
            Game Mode</label>
          <label><input class="uk-radio settings-radio" type="radio" name="mf-song-pool" value="2" disabled>
            µ's</label>
          <label><input class="uk-radio settings-radio" type="radio" name="mf-song-pool" value="3" disabled>
            Aqours</label>
          <hr>

          <h3 class="uk-text-bold" href="#">{{i18n/passwordAndEmail}}</h3>
          <h4 style="color: red">{{nl2br i18n/passwordNotice}}</h4>
          <div class="uk-flex uk-margin-small">
            <div class="uk-width-1-2">
              <div class="uk-margin-small">
                <div class="uk-inline">
                  <span class="uk-form-icon uk-form-icon-flip" data-uk-icon="icon: lock"></span>
                  <input id="newPassword" class="uk-input uk-border-pill" required placeholder="{{i18n/newPassword}}"
                    type="password">
                </div>
              </div>
              <div class="uk-margin-small">
                <div class="uk-inline">
                  <span class="uk-form-icon uk-form-icon-flip" data-uk-icon="icon: lock"></span>
                  <input id="newPassword2" class="uk-input uk-border-pill" required
                    placeholder="{{i18n/repeatPassword}}" type="password">
                </div>
              </div>
              <button type="button" class="uk-button uk-button-primary uk-border-pill" onclick="changePassword()"
                style="white-space: nowrap;">{{i18n/changePassword}}</button>
            </div>
            <div class="uk-width-1-2 uk-margin-left">
              <div class="uk-margin-small">
                <div class="uk-inline">
                  <span class="uk-form-icon uk-form-icon-flip" data-uk-icon="icon: mail"></span>
                  <input id="mail" class="uk-input uk-border-pill" required {{#if userData/mail}}
                    placeholder="{{userData/mail}}" {{else}} placeholder="{{i18n/email}}" {{/if}} type="text">
                </div>
              </div>
              <div class="uk-margin-small">
                <div class="uk-inline">
                  <span class="uk-form-icon uk-form-icon-flip" data-uk-icon="icon: lock"></span>
                  <input id="currentPassword" class="uk-input uk-border-pill" required
                    placeholder="{{i18n/currentPassword}}" type="password">
                </div>
              </div>
              <button type="button" class="uk-button uk-button-primary uk-border-pill" onclick="changeMail()"
                style="white-space: nowrap;">{{i18n/changeEmail}}</button>
            </div>
          </div>

          <hr>

          <h3 class="uk-text-bold" href="#">Массовое удаление карт</h3>
          <h4 class="uk-margin-remove">Позволяет удалить карты, которые не состоят в командах, не выбраны в качестве
            партнёра и не помечены замочком.</h4>
          <div class="uk-margin-small">
            <label for="bulk-delete" class="uk-form-label">Редкость:</label>
            <input class="uk-radio sl-bulk-delete" type="radio" name="bulk-delete" value="4"> UR
            <input class="uk-radio sl-bulk-delete" type="radio" name="bulk-delete" value="5"> SSR
            <input class="uk-radio sl-bulk-delete" type="radio" name="bulk-delete" value="3"> SR
            <input class="uk-radio sl-bulk-delete" type="radio" name="bulk-delete" value="2"> R
            <input class="uk-radio sl-bulk-delete" type="radio" name="bulk-delete" value="1"> N
            <br>
            <button id="bulk-delete-button" type="button" class="uk-button uk-button-primary uk-border-pill"
              href="#bulk-delete-modal" uk-toggle disabled>Удалить!</button>
          </div>

          <hr class="uk-margin-bottom">
        </div>

      <div id="bulk-delete-modal" uk-modal="bg-close: false;">
        <div class="uk-modal-dialog">
          <button class="uk-modal-close-default" type="button" uk-close></button>
          <div class="uk-modal-header">
            <h3 class="uk-modal-title uk-dark">Вы уверены?</h3>
          </div>
          <div class="uk-modal-body">
            <p id="deleteNotice" style="color: red" class="uk-dark"></p>
            <p>Введите пароль / Handover ID для подтверждения действия.</p>
            <div class="uk-margin-small">
              <div class="uk-inline uk-width-1-1">
                <span class="uk-form-icon uk-form-icon-flip" data-uk-icon="icon: lock"></span>
                <input id="currentPasswordConfirmation" class="uk-input uk-border-pill" required
                  placeholder="{{i18n/password}}" autocomplete="off" readonly
                  onfocus="this.removeAttribute('readonly');" type="password">
              </div>
            </div>

            <h5 class="uk-text-muted uk-margin-remove">Выполнение запроса может занять до двух минут.</h5>
          </div>
          <div class="uk-modal-footer">

            <div class="uk-text-right">
              <button type="button" class="uk-button uk-button-primary uk-border-pill"
                onclick="bulkDelete()">Подтвердить</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  var publicKey = {{{ publicKey }}}
</script>
<script type="text/javascript">
  var RSAEncrypt = new JSEncrypt()
  RSAEncrypt.setKey(publicKey)

  function changePassword() {
    var currentPass = $("#currentPassword").val()
    var pass = $("#newPassword").val()
    var pass2 = $("#newPassword2").val()

    if (currentPass.length === 0) return sendNotification("{{i18n/currentPasswordBlank}}", "warning")
    if (currentPass.length > 32) return sendNotification("{{i18n/currentPasswordLimit}}", "warning")
    if (!checkPass(currentPass)) return sendNotification("{{i18n/currentPasswordInvalidFormat}}", "warning")

    if (pass.length === 0) return sendNotification("{{i18n/newPasswordBlank}}", "warning")
    if (pass.length > 32) return sendNotification("{{i18n/newPasswordLimit}}", "warning")
    if (!checkPass(pass)) return sendNotification("{{i18n/newPasswordInvalidFormat}}", "warning")
    if (pass != pass2) return sendNotification("{{i18n/passwordsNotMatch}}", "warning")

    $.when(sendRequest({
      module: "settings",
      action: "changePassword",
      password: RSAEncrypt.encrypt(xor(currentPass, parseQueryString(headers.authorize).token)),
      newPassword: RSAEncrypt.encrypt(xor(pass, parseQueryString(headers.authorize).token)),
      timestamp: Math.floor(Date.now() / 1000)
    })).done(function (response) {
      if (response.error || response.maintenance || !response) return

      $("#currentPassword, #newPassword, #newPassword2").val("")
      sendNotification("{{i18n/passwordChangeSuccess}}", "success")
    })
  }
  function changeMail() {
    var mail = $("#mail").val()
    var pass = $("#currentPassword").val()

    if (pass.length === 0) return sendNotification("{{i18n/currentPasswordBlank}}", "warning")
    if (pass.length > 32) return sendNotification("{{i18n/currentPasswordLimit}}", "warning")
    if (!checkPass(pass)) return sendNotification("{{i18n/currentPasswordInvalidFormat}}", "warning")

    if (mail.length === 0) return sendNotification("{{i18n/mailBlank}}", "warning")
    if (!checkMail(mail)) return sendNotification("{{i18n/mailInvalidFormat}}", "warning")

    $.when(sendRequest({
      module: "settings",
      action: "changeMail",
      mail: mail,
      password: RSAEncrypt.encrypt(xor(pass, parseQueryString(headers.authorize).token)),
      timestamp: Math.floor(Date.now() / 1000)
    })).done(function (response) {
      if (response.error || response.maintenance || !response) return

      $("#mail").attr("placeholder", mail)
      $("#mail, #currentPassword").val("")
      sendNotification("{{i18n/mailChangeSuccess}}", "success")
    })
  }
  function bulkDelete() {
    var pass = $("#currentPasswordConfirmation").val()

    if (pass.length === 0) return sendNotification("{{i18n/currentPasswordBlank}}", "warning")
    if (pass.length > 32) return sendNotification("{{i18n/currentPasswordLimit}}", "warning")
    if (!checkPass(pass)) return sendNotification("{{i18n/currentPasswordInvalidFormat}}", "warning")

    $.when(sendRequest({
      module: "settings",
      action: "bulkDelete",
      password: RSAEncrypt.encrypt(xor(pass, parseQueryString(headers.authorize).token)),
      rarity: parseInt($("input[name=bulk-delete]:checked").val()),
      timestamp: Math.floor(Date.now() / 1000)
    })).done(function (response) {
      if (response.error || response.maintenance || !response) return

      UIkit.modal("#bulk-delete-modal").hide()
      $("#currentPasswordConfirmation").val("")
      sendNotification(replacePlaceholders(response.response_data, {
        points: response.response_data.points
      }), "success")
    })
  }

  $(".settings-radio").change(function () {
    sendRequest({
      module: "settings",
      action: "set",
      name: this.name,
      value: parseInt(this.value),
      timestamp: Math.floor(Date.now() / 1000)
    })
  })
  $(".sl-bulk-delete").change(function () {
    var rarity = {
      "1": "N",
      "2": "R",
      "3": "SR",
      "4": "UR",
      "5": "SSR"
    }
    $("#deleteNotice").text(replacePlaceholders("Вы собираетесь удалить карты редкости \{{rarity\}}. Это действие невозможно отменить!", {
      rarity: rarity[this.value]
    }))
    $("#bulk-delete-button").prop("disabled", false)
  })
</script>