<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>SunLight WebView</title>

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, user-scalable=no">

  <link rel="stylesheet" type="text/css" href="/resources/css/uikit.min.css">
  <link rel="stylesheet" type="text/css" href="/resources/css/perfect-scrollbar.css">
  <link rel="stylesheet" type="text/css" href="/resources/css/common.css">
</head>

<style>
  .stats_entry {
    display: flex;
    margin: 0px;
    justify-content: space-between;
  }

  .stats_test {
    font-weight: 450;
  }

  .stats_value {
    margin-left: 5px;
    font-weight: 700;
  }
</style>

<body>
  <div id="outer">
    <div id="inner">
      <div id="header">
        {{{header i18n/profile this}}}
      </div>

      <div id="body" class="uk-scrollspy-inview uk-animation-fade">

        <div class="uk-container uk-width-1-1 uk-margin">
          <div class="uk-flex uk-margin-small-top">
            <div>
              <div class="avatar-border" style="background-image: url('//r.llsif.win/{{icon}}');">
              </div>
            </div>
            <div class="uk-margin-left">
              <h3 class="uk-text-bold">{{user/name}}</h3>
              <span class="uk-text-muted"
                style="word-wrap: break-word;">{{nl2br user/introduction}}</span>
            </div>
          </div>
        </div>

        <div class="uk-container uk-width-1-1">
          <dl class="stats_entry">
            <dt class="stats_test">User ID</dt>
            <dd class="stats_value">{{numberWithSpaces user/user_id}}</dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">{{i18n/userRank}}</dt>
            <dd class="stats_value">{{numberWithSpaces user/rank}}</dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">{{i18n/registrationDate}}</dt>
            <dd class="stats_value" uk-tooltip="title: {{user/registrationDate}}">{{user/registrationDateFormated}}
            </dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">{{i18n/daysInTheGame}}</dt>
            <dd class="stats_value">{{numberWithSpaces user/daysInTheGame}}</dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">Времени в лайвах</dt>
            <dd class="stats_value" uk-tooltip="title: {{numberWithSpaces user/playTimeWithLowCombo}} with combo < 50 (lg farming?)">{{user/playTime}}</dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">{{i18n/livesPlayed}}</dt>
            <dd class="stats_value">{{numberWithSpaces user/livesPlayed}}</dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">Всего очков</dt>
            <dd class="stats_value">{{numberWithSpaces user/totalScore}}</dd>
          </dl>
          <dl class="stats_entry">
            <dt class="stats_test">Максимальное комбо</dt>
            <dd class="stats_value">{{numberWithSpaces user/maxCombo}}</dd>
          </dl>
        </div>


        {{#if haveEventData}}
        <div class=" uk-container uk-margin uk-width-1-1">
          <hr>
          <h3 class="uk-text-bold uk-align-center">
            <center>{{i18n/events}}</center>
          </h3>
          <div class="uk-overflow-auto">
            <table class="uk-table uk-table-middle uk-table-divider uk-table-justify">
              <thead>
                <tr>
                  <th class="uk-table-shrink">{{i18n/eventType}}</th>
                  <th class="uk-table-shrink uk-text-nowrap" uk-tooltip="title: {{i18n/jpTimeZone}}; pos: top-left;">
                    {{i18n/eventStart}}</th>
                  <th class="uk-table-shrink uk-text-nowrap" uk-tooltip="title: {{i18n/jpTimeZone}}; pos: top-left;">
                    {{i18n/eventEnd}}</th>
                  <th class="uk-width-1-6">{{i18n/eventPtRank}}</th>
                  <th class="uk-table-shrink">{{i18n/eventScoreRank}}</th>
                  <th class="uk-table-shrink">{{i18n/livesPlayed}}</th>
                </tr>
              </thead>
              <tbody id="eventDataTableBody">
                {{#each eventData}}
                <tr class="eventData">
                  <td style="font-size: .9rem;">{{this/type}}</td>
                  <td class="uk-text-nowrap" style="font-size: .9rem;" uk-tooltip="{{../i18n/jpTimeZone}}">
                    {{momentFormat this/start_date "DD.MM.YY HH:mm"}}</td>
                  <td class="uk-text-nowrap" style="font-size: .9rem;" uk-tooltip="{{../i18n/jpTimeZone}}">
                    {{momentFormat this/end_date "DD.MM.YY HH:mm"}}</td>
                  <td class="uk-text-break">{{notAvailable this/ptRank}}</td>
                  <td>{{notAvailable this/scoreRank}}</td>
                  <td>{{notAvailable this/lives_played}}</td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
          {{#if haveMoreEventData}}
          <button id="loadMoreEventDataButton" type="button"
            class="uk-button uk-button-primary uk-button-small uk-align-center uk-border-pill uk-margin-small-top uk-text-uppercase"
            onclick="loadEventData()">
            <span class="uk-icon" uk-icon="triangle-down"></span> показать больше <span class="uk-icon"
              uk-icon="triangle-down"></span>
          </button>
          {{/if}}
          <hr class="uk-margin-remove-top">
        </div>
        {{/if}}
      </div>

      {{{changeLanguageModal}}}
    </div>
  </div>

  <script type="">
    var headers = {{{headers}}}
    var enableResize = true
    var userId = {{{userId}}}
  </script>
  <script type="text/javascript" src="/resources/js/uikit.min.js"></script>
  <script type="text/javascript" src="/resources/js/jquery.min.js"></script>
  <script type="text/javascript" src="/resources/js/common.js"></script>

  <script type="text/javascript" src="/resources/js/uikit-icons.min.js"></script>
  <script type="text/javascript" src="/resources/js/perfect-scrollbar.min.js"></script>
  <script type="text/javascript" src="/resources/js/change-language.js"></script>

  <script>
    var ps = new PerfectScrollbar('#body', { suppressScrollX: false })

    function loadEventData() {
      $("#loadMoreEventDataButton").attr("disabled", "disabled")
      var offset = $(".eventData").length

      $.when(sendRequest({
        module: "profile",
        action: "getEventData",
        offset: offset,
        limit: 10,
        userId: userId,
        timestamp: Math.floor(Date.now() / 1000)
      })).done(function (response) {
        if (response.error || response.maintenance || !response) return
        if (response.response_data.total === offset + response.response_data.added) $("#loadMoreEventDataButton").attr("hidden", "hidden")
        $("#eventDataTableBody").append(response.response_data.data)
        $("#loadMoreEventDataButton").removeAttr("disabled")
      }).fail(function () {
        $("#loadMoreEventDataButton").removeAttr("disabled")
      })
    }
  </script>
</body>

</html>